<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/JuDocWeb/libs/highlight/github.min.css"> <link rel=stylesheet  href="/JuDocWeb/css/jtd.css"> <link rel=icon  href="/JuDocWeb/assets/infra/favicon2.gif"> <title>Inserting and evaluating code</title> <script src="/JuDocWeb/libs/lunr/lunr.min.js"></script> <script src="/JuDocWeb/libs/lunr/lunr_index.js"></script> <script src="/JuDocWeb/libs/lunr/lunrclient.min.js"></script> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/JuDocWeb/" class=title > <img style="height:60px;" src="/JuDocWeb/assets/infra/judoc.svg" alt=judoc  /> <style> @media (max-width: 31.25rem){ .side-bar .show-menu {height:30px;} } @media (max-width: 50rem) { .side-bar .header .title {padding-top:0; padding-bottom: 0;} .header .title img {height:60px; max-width: 100px !important;} } @media (min-width: 66.5rem){ .header .title img {max-width: 120px !important;} } </style> </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/JuDocWeb/" class=menu-list-link >• Home</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/workflow.html" class=menu-list-link >• Workflow</a> <li class="menu-list-parent "><a href="/JuDocWeb/pub/syntax/markdown.html">• Syntax</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/JuDocWeb/pub/syntax/markdown.html" class=menu-list-link >Markdown</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/syntax/divs-commands.html" class=menu-list-link >Divs and Commands</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/syntax/page-variables.html" class=menu-list-link >Page Variables</a> </ul> <li class="menu-list-parent "><a href="/JuDocWeb/pub/styling/templates.html">• Styling</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/JuDocWeb/pub/styling/templates.html" class=menu-list-link >Templates</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/styling/classes.html" class=menu-list-link >Classes</a> </ul> <li class="menu-list-parent active"><a href="/JuDocWeb/pub/code/inserting-code.html">• Code</a> <ul class="menu-list-child-list "> <li class="menu-list-item active"><a href="/JuDocWeb/pub/code/inserting-code.html" class=menu-list-link >Inserting code</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/code/eval-tricks.html" class=menu-list-link >Code tricks</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/code/literate.html" class=menu-list-link >Literate.jl</a> </ul> <li class="menu-list-parent "><a href="/JuDocWeb/pub/faq/technical.html">• FAQ</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/JuDocWeb/pub/faq/technical.html" class=menu-list-link >Technical</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/faq/troubleshooting.html" class=menu-list-link >Troubleshooting</a> <li class="menu-list-item "><a href="/JuDocWeb/pub/faq/why-o-why.html" class=menu-list-link >Meta</a> </ul> </ul> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/JuDocWeb/search.html"> </form> </div> <div class=footer > <a href="/JuDocWeb/pub/faq/why-o-why.html"><img style="width:60%;padding-left:10px;margin-bottom:15px;" src="/JuDocWeb/assets/infra/logo1.svg" alt="JuDoc Logo" /></a> </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a name=pagetop ></a> <a id=github  href="https://github.com/tlienart/JuDoc.jl">GitHub Repo</a> </div> <div class=jd-content > <h1 id=inserting_and_evaluating_code ><a href="/JuDocWeb/pub/code/inserting-code.html#inserting_and_evaluating_code">Inserting and evaluating code</a></h1> <span style="font-size:24px;font-weight:300;">JuDoc can evaluate any Julia code block on the fly and display the results.</span> <div class=blank ></div> <div class=jd-toc ><ol><li><a href="/JuDocWeb/pub/code/inserting-code.html#inserting_code">Inserting code</a><li><a href="/JuDocWeb/pub/code/inserting-code.html#evaluating_code">Evaluating code</a><ol><li><a href="/JuDocWeb/pub/code/inserting-code.html#live_evaluation_julia">Live evaluation &#40;Julia&#41;</a><li><a href="/JuDocWeb/pub/code/inserting-code.html#separate_evaluation">Separate evaluation</a></ol></ol></div> <h2 id=inserting_code ><a href="/JuDocWeb/pub/code/inserting-code.html#inserting_code">Inserting code</a></h2> <p>As per Common Mark specifications, you have multiple ways of inserting code:</p> <ul> <li><p><strong>inline code</strong>: you can use single backticks &#40;&#96;&#41; or double backticks &#40;&#96;&#96;&#41; &#40;if the code contains single ticks&#41; like so:</p> </ul> <pre><code class="plaintext hljs">This is some `inline code` or ``inline ` code with a tick``.</code></pre>
<ul>
<li><p><strong>code blocks</strong>: it is recommended to use triple backticks &#40;&#96;&#96;&#96;&#41; optionally followed by a language name for highlighting like so:</p>

</ul>
<pre><code class="julia hljs">This is some julia code:
<span class=hljs-string >``</span><span class=hljs-string >`julia
a = 2
@show a
`</span><span class=hljs-string >``</span></code></pre>
<ul>
<li><p><strong>code blocks 2</strong>: you can also use indented code blocks &#40;lines starting with four spaces or a tab&#41; but <em>fenced code blocks should be preferred</em></p>

</ul>
<pre><code class="julia hljs">This is some code:

    a = <span class=hljs-number >2</span>
    <span class=hljs-meta >@show</span> a</code></pre>
<p><strong>Note</strong>: when either using indented code blocks or using fenced code blocks with no language name, then the code language for highlighting can be specified with the local page variable <code>lang</code> i.e. <code>@def lang &#61; &quot;julia&quot;</code> &#40;which is the default&#41; or <code>@def lang &#61; &quot;&quot;</code> if you don&#39;t want the code to be highlighted.</p>
<h2 id=evaluating_code ><a href="/JuDocWeb/pub/code/inserting-code.html#evaluating_code">Evaluating code</a></h2>
<p>When presenting code in a post, it&#39;s often convenient to have a way to check the code works and the output shown corresponds to the code. In JuDoc there are two approaches that help you for this:</p>
<div class=tlist ><ol>
<li><p>For Julia code, a <strong>live-evaluation</strong> of code blocks is supported,</p>

<li><p>For all languages, you can run the script separately and use JuDoc to insert the code file and/or the output generated by the code.</p>

</ol>
</div>
<h3 id=live_evaluation_julia ><a href="/JuDocWeb/pub/code/inserting-code.html#live_evaluation_julia">Live evaluation &#40;Julia&#41;</a></h3>
<p>Julia code blocks can be evaluated on the fly and their output either displayed as code or re-interpreted as Markdown.</p>
<div class=note ><div class=title >⚠ Note</div> <div class=content ><strong>Evaluation time</strong>: when a code block is created or modified and the page is saved, it will trigger a page build that will <em>wait</em> for the evaluation of the code block to complete. So if your code block takes a long time to execute, the page will not be updated before that&#39;s done.     That being said, if you don&#39;t modify the code block, it will only be executed <strong>once</strong> as the output is saved to file.</div></div>
<div class=note ><div class=title >⚠ Note</div> <div class=content ><strong>Sandboxing</strong>: on-the-fly evaluation of code blocks is still a bit experimental. Among other things, the code is <em>not sandboxed</em> which means that if you have two code blocks one after the other, the second one has access to what&#39;s defined in the first &#40;like a notebook&#41;. This is natural within the same page, but it also works <em>across</em> pages and  you should ensure that you don&#39;t rely on  this as the order in which pages are compiled depends on what you modify.</div></div>
<p>In short: take a page as a Julia notebook and make sure all your variables and functions you use are defined on that page. Code blocks that <em>should not</em> be evaluated should be added as per standard markdown, so for instance:</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia
a = 10
`</span><span class=hljs-string >``</span></code></pre>
<p>Code blocks that <em>should</em> be evaluated should be added with <code>julia:path/to/script</code> where <code>path/to/script</code> indicates <em>where</em> the script corresponding to the code block will be saved &#40;<strong>note</strong>: the given path <em>must</em> be in UNIX format even if you&#39;re on Windows&#41;</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia:./code/ex1
a = 10
@show a
`</span><span class=hljs-string >``</span></code></pre>
<p>What this will do is:</p>
<div class=tlist ><ol>
<li><p>write the code to the file <code>/assets/&#91;subpath&#93;/code/ex1.jl</code></p>

<li><p>run the code and capture its output &#40;<code>STDOUT</code>&#41; and write it to <code>/assets/&#91;subpath&#93;/code/output/ex1.out</code></p>

</ol>
</div>
<p>The <code>&#91;subpath&#93;</code> here is the <em>exact same sub-path structure</em> than to the page where the code block is inserted. To clarify, let&#39;s say you wrote the above code-block in</p>
<pre><code class="julia hljs">/src/pages/folder1/page1.md</code></pre>
<p>then with the syntax above, the script will be saved in</p>
<pre><code class="julia hljs">/assets/pages/folder1/code/ex1.jl</code></pre>
<h4 id=more_on_paths ><a href="/JuDocWeb/pub/code/inserting-code.html#more_on_paths">More on paths</a></h4>
<p>There are three ways you can specify where the script corresponding to a code-block should be saved.</p>
<ol>
<li><p><em>relative to the page</em>: <code>./&#91;p&#93;/script</code> is as above, it will write the code block to <code>/assets/&#91;subpath&#93;/p/script.jl</code> where <code>subpath</code> corresponds to the sub-path of the page where the code block is inserted &#40;path below <code>/src/</code>&#41;</p>

<li><p><em>relative to the assets dir</em>: <code>p/script</code> will write the code block to <code>/assets/p/script.jl</code></p>

<li><p><em>full path</em>: <code>/p/script</code> will write the code block to <code>/p/script.jl</code></p>

</ol>
<p><strong>Note</strong>: when code blocks are evaluated, their output &#40;<code>STDOUT</code>&#41; is captured and saved at <code>&#91;path&#93;/output/script.out</code> where <code>&#91;path&#93;</code> is what precedes <code>script.jl</code> in the cases above.</p>
<h4 id=inserting_the_output ><a href="/JuDocWeb/pub/code/inserting-code.html#inserting_the_output">Inserting the output</a></h4>
<p>Let&#39;s say you&#39;ve added the following code block:</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia:./code_pg1/ex1
using LinearAlgebra
a = [1, 2, 3]
@show dot(a, a)
`</span><span class=hljs-string >``</span></code></pre>
<p>In order to show the raw output, just write</p>
<pre><code class="julia hljs">\output{./code_pg1/ex1}</code></pre>
<p>which in the present example will introduce exactly the following HTML</p>
     <pre><code class="html hljs">&amp;lt;pre&amp;gt;&amp;lt;code class&amp;#61;&amp;quot;language-julia&amp;quot;&amp;gt;dot&amp;#40;a, a&amp;#41; &amp;#61; 14&amp;lt;/code&amp;gt;&amp;lt;/pre&amp;gt;</code></pre>
<p>and will look like</p>
<pre><code class="julia hljs">dot(a, a) = <span class=hljs-number >14</span></code></pre>
<p>If you now change the vector <code>a</code> in the code block, the page will be re-compiled with the code-block re-evaluated and the new output will be shown.</p>
<p>If you would like the output to be re-interpeted by JuDoc as text, you can use <code>\textoutput</code> instead. Here&#39;s an example:</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia:./code_pg1/ex2
using Statistics
temps = (15, 15, 14, 16, 18, 19, 20, 12, 10, 24)
println("The _average_ temperature is **<span class=hljs-subst >$(mean(temps)</span>)°C**.")
`</span><span class=hljs-string >``</span>
\textoutput{./code_pg1/ex2}</code></pre>
<p>Which will appear as:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Statistics
temps = (<span class=hljs-number >15</span>, <span class=hljs-number >15</span>, <span class=hljs-number >14</span>, <span class=hljs-number >16</span>, <span class=hljs-number >18</span>, <span class=hljs-number >19</span>, <span class=hljs-number >20</span>, <span class=hljs-number >12</span>, <span class=hljs-number >10</span>, <span class=hljs-number >24</span>)
println(<span class=hljs-string >"The _average_ temperature is **<span class=hljs-subst >$(mean(temps)</span>)°C**."</span>)</code></pre>
<p>The <em>average</em> temperature is <strong>16.3°C</strong>.</p>
<h4 id=hiding_lines ><a href="/JuDocWeb/pub/code/inserting-code.html#hiding_lines">Hiding lines</a></h4>
<p>Sometimes you may want to run some lines but hide them from the presentation, for this just use <code># hide</code> at the end of the line &#40;<code>hide</code> is not case sensitive so <code># HiDe</code> would be fine too&#41;:</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia:./code_pg1/ex1
using LinearAlgebra # hide
a = [1, 2, 3]
@show dot(a, a)
`</span><span class=hljs-string >``</span></code></pre>
<p>You could also hide the entire code block if you only care about the output, for this put a <code># hideall</code> on any line:</p>
<pre><code class="julia hljs"><span class=hljs-string >``</span><span class=hljs-string >`julia:./code_pg1/ex2
#hideall
using Statistics
temps = (15, 15, 14, 16, 18, 19, 20, 12, 10, 24)
println("The _average_ temperature is **<span class=hljs-subst >$(mean(temps)</span>)°C**.")
`</span><span class=hljs-string >``</span>
\textoutput{./code_pg1/ex2}</code></pre>
<p>Which will appear as just:</p>
<p>The <em>average</em> temperature is <strong>16.3°C</strong>.</p>
<h4 id=projecttoml ><a href="/JuDocWeb/pub/code/inserting-code.html#projecttoml">Project.toml</a></h4>
<p>It can be convenient to set up your website as you would a Julia environment: <em>activating</em> it and <em>adding</em> the packages that you will use in code blocks. For this, just activate the environment as you would otherwise, this will generate a <code>Project.toml</code> which will subsequently  be used by JuDoc without  you having to worry about it.</p>
<p>For instance, let&#39;s say that you want to use <code>PyCall</code> in some code blocks, then before starting the JuDoc server do</p>
<pre><code class="julia-repl hljs">1.x pkg&gt; activate .
<span class=hljs-metap>(myWebsite) pkg&gt;</span> add PyCall</code></pre>
<p>once that&#39;s done, if you now start the server, JuDoc will write</p>
<pre><code class="julia-repl hljs"><span class=hljs-meta >julia&gt;</span><span class=julia > serve()
</span>Activating environment at `~/Desktop/myWebsite/Project.toml`</code></pre>
<p>In other words, whenever you start the server, JuDoc will now activate the environment with that <code>Project.toml</code>. This is particularly useful if you intend to write a tutorial website &#40;for a live example of this, see the <a href="https://alan-turing-institute.github.io/MLJTutorials/">MLJ Tutorials</a>&#41;.</p>
<h3 id=separate_evaluation ><a href="/JuDocWeb/pub/code/inserting-code.html#separate_evaluation">Separate evaluation</a></h3>
<p>The philosophy here is:</p>
<div class=tlist ><ul>
<li><p>keep your code snippets in appropriate subfolders of <code>/assets/</code> where they can be run and their output can be saved, this can be compared to a <code>test/</code> folder in a Julia package,</p>

<li><p>run some or all of the snippets &#40;before running JuDoc&#41;,</p>

<li><p>use <code>\input&#123;...&#125;&#123;...&#125;</code> in your markdown &#40;see below&#41; and when the website is updated, it will plug-in the most recent parts that have been generated.</p>

</ul>
</div>
<p>That way, if you modify the code, everything will be updated on the website too while ensuring that the code actually runs and generates the output you&#39;re displaying.</p>
<p>Again, the script files can contain <code># hide</code> at the end of lines you do not want to show.</p>
<p>The <code>generate_results.jl</code> file should run the scripts and redirect outputs to the <code>assets/&#91;path&#93;/output</code> directory. You can use something like the script below &#40;if you generate an example website with <code>newsite</code>, it&#39;s already in there&#41; though you can of course modify it as you wish.</p>
<pre><code class="julia hljs">dir = <span class=hljs-meta >@__DIR__</span>
<span class=hljs-string >"""
genplain(s)

Small helper function to run some code and redirect the output (stdout) to a file.
"""</span>
<span class=hljs-keyword >function</span> genplain(s::<span class=hljs-built_in >String</span>)
    open(joinpath(dir, <span class=hljs-string >"output"</span>, <span class=hljs-string >"<span class=hljs-subst >$(splitext(s)</span>[1]).out"</span>), <span class=hljs-string >"w"</span>) <span class=hljs-keyword >do</span> outf
        redirect_stdout(outf) <span class=hljs-keyword >do</span>
            include(joinpath(dir, s))
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>
<span class=hljs-comment ># run `script1.jl` and redirect what it prints to `output/script1.out`</span>
genplain(<span class=hljs-string >"script1.jl"</span>)
<span class=hljs-comment ># run `script2.jl` which has a savefig(joinpath(@__DIR__, "output", "script2.png"))</span>
include(<span class=hljs-string >"script2.jl"</span>)</code></pre>
<p>The function <code>genplain&#40;&quot;scriptname.jl&quot;&#41;</code> just redirects the output of the script to <code>output/scriptname.out</code>. So for instance if you have in <code>assets/scripts/script1.jl</code>
<pre><code class="julia hljs">print(<span class=hljs-string >"hello"</span>)</code></pre>
<p>Then <code>genplain&#40;&quot;script1.jl&quot;&#41;</code> will generate <code>/assets/scripts/output/script1.out</code> with content</p>
<pre><code class="julia hljs">hello</code></pre>
<div class=note ><div class=title >⚠ Note</div> <div class=content >You could have scripts in any language here &#40;<code>R</code>, <code>Python</code>, ...&#41; as long as the folder structure is the same.</div></div>
<h4 id=inserting_code__2 ><a href="/JuDocWeb/pub/code/inserting-code.html#inserting_code__2">Inserting code</a></h4>
<p>In order to insert the code of a script and have it highlighted you can use</p>
<pre><code class="julia hljs">\input{julia}{scripts/script1.jl}</code></pre>
<p>or <code>\input&#123;code:julia&#125;&#123;scripts/script1.jl&#125;</code>. This will insert the content of the file <code>/assets/scripts/script1.jl</code> &#40;see also the section earlier on paths&#41; into a block that will be highlighted as julia code.</p>
<h4 id=plain-text_output ><a href="/JuDocWeb/pub/code/inserting-code.html#plain-text_output">Plain-text output</a></h4>
<p>In order to insert the plain-text output of a script, you can use</p>
<pre><code class="julia hljs">\input{output}{scripts/script1.jl}</code></pre>
<p>or <code>\input&#123;output:plain&#125;&#123;scripts/script1.jl&#125;</code>. This will insert the content of the file <code>/assets/scripts/script1.out</code> into a non-highlighted code-block.</p>
<h4 id=plot_output ><a href="/JuDocWeb/pub/code/inserting-code.html#plot_output">Plot output</a></h4>
<p>In order to insert a plot generated by a script, you can use</p>
<pre><code class="julia hljs">\input{plot}{scripts/script1.jl}</code></pre>
<p>or <code>\input&#123;plot:id&#125;&#123;scripts/script1.jl&#125;</code>. This will look for an image file with root name <code>/assets/scripts/script1.ext</code> where <code>ext</code> is <code>gif, png, jp&#40;e&#41;g, svg</code>. If you use <code>plot:id</code> then it will look for an image file with root name <code>/assets/scripts/script1id.ext</code>.</p>
<p>The <code>plot:id</code> option is useful if you have a script that generates several plots for instance.</p>
<h4 id=slicing_up ><a href="/JuDocWeb/pub/code/inserting-code.html#slicing_up">Slicing up</a></h4>
<p>The structure in the <code>generate_results.jl</code> effectively means that all your code is run as one big script. This also means that if you want to slice some of your code in several parts and show intermediate outputs &#40;e.g. plots&#41;, you can just do that by having a <code>script_1_p1.jl</code>, <code>script_1_p2.jl</code> etc. and then just use  <code>\input</code> multiple times.
<div class=page-foot >
  <div class=copyright >
    &copy; Thibaut Lienart. Last modified: December 23, 2019. Website built with <a href="https://github.com/tlienart/JuDoc.jl">JuDoc.jl</a>.
  </div>
</div>

</div>

    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->